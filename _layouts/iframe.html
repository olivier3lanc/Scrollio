<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% assign pagecontent_description = page.content | markdownify | replace: '.', '. ' | replace: '</h2>', ': ' | replace: '</h3>', ': ' | replace: '</h4>', ': ' | strip_html | strip_newlines | replace: '  ', ' ' | truncate: 160 %}
        <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{% if pagecontent_description.size > 10 %}{{ pagecontent_description }}{% else %}{{ site.description }}{% endif %}{% endif %} ">
        <link rel="stylesheet" href="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/css/normalize.css">
        <!-- Scrollio required stylesheet -->
        <link href="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/css/full.css" rel="stylesheet">
    </head>
    <body>
        <div id="scrollio">
            {{ content }}
        </div>
        <script type="text/javascript" src="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/js/jquery/jquery-3.4.0.min.js"></script>

        <script type="text/javascript" src="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/js/scrollio/scrollio.js"></script>
        <script type="text/javascript" src="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/js/scrollio/plugins/scrollio.plugin.dynamic.background.js"></script>
        <!-- <script type="text/javascript" src="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/js/scrollio/plugins/scrollio.plugin.fullscreen.js"></script>
        <script type="text/javascript" src="{{ site.url }}{{ site.baseurl }}{{ site.assets_dir }}/js/scrollio/plugins/scrollio.plugin.links.js"></script> -->
        <script type="text/javascript">
            //Defaults parameters
            var defaultParameters = {
                //ID if the main Scrollio wrapper
                id:                     'scrollio',
                //Amount of pixels scrolled per item
                scrollRange:            2000,
                //Once scrolled, letters keep active CSS class
                keepActive:             true,
                // Position of the item (top, middle, bottom)
                itemPosition:           'middle',
                // Alignment of the item (left, center, right)
                itemAlignment:          'center',
                // Alignment of the text into its item
                textAlignment:          'center',
                //String displayed at the end of each text to scroll
                textEllipsis:           '...',
                //Transition Duration between letter states in ms
                textTransitionDuration: 300,
                //Google Font name
                //Or Web safe font name:
                //'Arial','Helvetica','Courier New','Georgia',
                //'Times New Roman','Verdana','serif','sans-serif',
                //'monospace','cursive','fantasy'
                fontFamily:             'Ubuntu',
                //Font weight (applicable only for Google Fonts)
                fontWeight:             'Bold',
                //Each letter is under the previous
                fontOverlapUnder:       true,
                //Display the progress bar
                progressBar:            true,
                //Display overlay between items and body background
                overlay:                true,
                //Automatic font size
                //Adjust each item font size according to the amount of characters
                //and the screen size. Overrides responsive font sizes
                fontSizeAuto:           false,
                //Responsive font size in pixels for Extra-Large devices
                fontSizeXL:             84,
                //Responsive font size in pixels for Large devices
                fontSizeLG:             64,
                //Responsive font size in pixels for Medium devices
                fontSizeMD:             50,
                //Responsive font size in pixels for Small devices
                fontSizeSM:             40,
                //Responsive font size in pixels for Extra-Small devices
                fontSizeXS:             32,
                //Responsive break point in pixels between large and extra-large
                breakPointLG_XL:        1200,
                //Responsive break point in pixels between medium and large
                breakPointMD_LG:        992,
                //Responsive break point in pixels between small and medium
                breakPointSM_MD:        768,
                //Responsive break point in pixels between extra-small and small
                breakPointXS_SM:        575,
                //Cross fade duration between items in ms.
                //itemFadeDuration = 0 optimizes global performances
                itemFadeDuration:       500,
                //Enable/disable style overrides. Quickly remove all styles overrides
                //For testing and debug purpose.
                styleOverrides:         true,
                //Define basic responsive layout to item children for extra large devices
                //'horizontal': Horizontal stacking
                //'horizontal-reverse': Reverse order horizontal stacking
                //'vertical':  Vertical stacking
                //'vertical-reverse': Reverse order vertical stacking
                itemContentLayoutXL:  'horizontal',
                //Define basic responsive layout to item children for large devices
                //'horizontal': Horizontal stacking
                //'horizontal-reverse': Reverse order horizontal stacking
                //'vertical':  Vertical stacking
                //'vertical-reverse': Reverse order vertical stacking
                itemContentLayoutLG:  'horizontal',
                //Define basic responsive layout to item children for medium devices
                //'horizontal': Horizontal stacking
                //'horizontal-reverse': Reverse order horizontal stacking
                //'vertical':  Vertical stacking
                //'vertical-reverse': Reverse order vertical stacking
                itemContentLayoutMD:  'vertical',
                //Define basic responsive layout to item children for small devices
                //'horizontal': Horizontal stacking
                //'horizontal-reverse': Reverse order horizontal stacking
                //'vertical':  Vertical stacking
                //'vertical-reverse': Reverse order vertical stacking
                itemContentLayoutSM:  'vertical',
                //Define basic responsive layout to item children for extra small devices
                //'horizontal': Horizontal stacking
                //'horizontal-reverse': Reverse order horizontal stacking
                //'vertical':  Vertical stacking
                //'vertical-reverse': Reverse order vertical stacking
                itemContentLayoutXS:  'vertical',
                //@keyframes animations declarations that have to be used into the custom CSS
                animationsCSS:          {
                    'cursor': {
                        '0%': 'opacity: 0',
                        '100%': 'opacity: 1'
                    }
                },
                //CSS overrides of scrolled text BEFORE Scrollio initialization
                sentenceBeforeInitCSS:  {
                },
                //CSS overrides of scrolled text AFTER Scrollio initialization
                sentenceAfterInitCSS:   {
                },
                //CSS overrides of page body
                bodyCSS:                {
                    'background-color': '#1b4b7d',
                    'color': '#fff'
                },
                //CSS overrides of Scrollio container
                scrollioContainerCSS:   {

                },
                //CSS overrides of an inactive item
                itemDefaultCSS:         {
                    'padding': '10vw'
                },
                //CSS overrides of an active item
                itemActiveCSS:          {
                },
                //CSS overrides of the whole scrolled text sentence
                sentenceCSS:            {
                    'line-height': '1.3em'
                },
                //CSS overrides of a word
                wordCSS:                {
                },
                //CSS overrides of a letter not scrolled yet
                letterDefaultCSS:       {
                    'color': 'white',
                    'margin-left': '-0.1em',
                    'opacity': '0.3',
                    // DO NOT INCLUDE 'transition' property because it fails at start
                    'text-shadow': '0.07em 0.01em 0.1em rgba(0,0,0,.5)',
                    'transform': 'scale(0.8) translateX(-0.1em) translateY(0px)'
                },
                //CSS overrides of a scrolled or currently scrolled letter
                letterActiveCSS:        {
                    'color': 'white',
                    'opacity': '1',
                    'transform': 'scale(1) translateX(0px)  translateY(0px)'
                },
                //CSS overrides of the currently scrolled letter
                letterCurrentCSS:       {
                },
                //CSS overrides of the cursor included only into currently scrolled letter
                cursorCSS:              {
                    'top': '0px',
                    'right': '0px',
                    'width': '2px',
                    'height': '100%',
                    'background-color': 'white',
                    'animation-name': 'cursor', //Declared into g_parameters.animationsCSS
                    'animation-duration': '600ms',
                    'animation-iteration-count': 'infinite',
                    'animation-direction': 'alternate'
                },
                //CSS overrides of the entire ellipsis word
                ellipsisWordCSS:     {

                },
                //CSS overrides of an ellipsis character not scrolled yet
                ellipsisDefaultCSS:     {

                },
                //CSS overrides of an ellipsis scrolled or currently scrolled
                ellipsisActiveCSS:      {

                },
                //CSS overrides of the ellipsis currently scrolled character
                ellipsisCurrentCSS:     {

                },
                //CSS overrides of the progress bar
                progressBarCSS:         {
                    'background-color': 'white'
                },
                //CSS overrides of the overlay layer
                overlayCSS:             {
                    'opacity': '1',
                    'background': 'radial-gradient(ellipse at top, transparent, #07131f)'
                },
                dynamicBackground:      {
                    scaleTo: 1.2
                },
                //Callback on Scrollio initialization
                onInit:                 function(e){},
                //Callback on item change
                onItemChange:           function(e){},
                //Callback on letter change
                onLetterChange:         function(e){},
                //Callback on scroll
                onScroll:               function(e){},
                //Callback on item end
                onItemEnd:              function(e){},
                //Callback on first item
                onFirstItem:            function(e){},
                //Callback on last item
                onLastItem:             function(e){},
                //Callback on scroll end
                onScrollEnd:            function(e){}
            };
            var finalParameters = defaultParameters;
            document.addEventListener("DOMContentLoaded", function(event) {
                //console.log("DOM fully loaded and parsed");

                var fullUrl = window.location.href;
                hash = fullUrl.split('?');
                var stringifiedSentObject = atob(hash[1]);
                var sentObject = JSON.parse(stringifiedSentObject);
                var wrapper = document.getElementById('scrollio');
                console.log('reçu:',sentObject);
                sentObject.content.forEach(function(data) {
                    // console.log('item text:'+data.text);
                    // console.log('item options:'+data.options);
                    // Check plugins
                    var dynamicBackgroundMarkup = '';
                    if (data.options.length > 0) {
                        // Loop item options
                        for (var index in data.options) {
                            if (data.options.hasOwnProperty(index)) {
                                // Item options must be an array of objects
                                if (typeof data.options[index] == 'object') {
                                    // Must have a key called 'name'
                                    if (typeof data.options[index]['name'] == 'string') {
                                        // Dynamic background ?
                                        if (data.options[index]['name'] == 'dynamicBackground') {
                                            dynamicBackgroundMarkup += 'data-dynamic-background="'+data.options[index]['value']+'"';
                                        }
                                    }
                                }
                            }
                        }
                    }
                    jQuery('#scrollio').append(
                        '<div class="item" '+dynamicBackgroundMarkup+'>'+
                            '<p class="scrolltrack">'+data.text+'</p>'+
                        '</div>'
                    );
                });
                window.scrollioAPI.dynamicBackground.jQ_items = jQuery('#scrollio>.item');
                // Manage parameters
                for (var param in sentObject.options) {
                    // If standard Scrollio param
                    if (sentObject.options.hasOwnProperty(param)) {
                        // console.log(param,sentObject.options[param]);
                        if (sentObject.options.hasOwnProperty(param)) {
                            finalParameters[param] = sentObject.options[param];
                        }
                        var textShadowProperty = '';
                        // Maybe it is a special param
                        if (param == 'textOverlap') {
                            finalParameters['letterDefaultCSS']['margin-left'] = sentObject.options[param]+'em';
                        }
                        if (param == 'textOpacityOff') {
                            finalParameters['letterDefaultCSS']['opacity'] = sentObject.options[param].toString();
                        }
                        if (param == 'textOpacityOn') {
                            finalParameters['letterActiveCSS']['opacity'] = sentObject.options[param].toString();
                        }
                    }
                }

                // wrapper.innerHTML = sentObject.content;
                jQuery.fn.scrollio(finalParameters);
            });
        </script>

    </body>
</html>
